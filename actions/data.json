{"actions": [{
    "id": "04rnCmZCWwwk0aohQaZJ",
    "type": "Update",
    "priority": 1,
    "condition": "{{message.dialogflow.intent == 'system.welcome' and sender.name == None}}",
    "params": {
        "collection": "persons",
        "content": "{'dialogflow': {'context': {'name': 'setup_name', 'lifespan': 1}}}",
        "identifier": "$sender.id"
    }
}, {
    "id": "2yULpJaMPlzCt7O5wLVW",
    "type": "Message",
    "priority": 1,
    "condition": "{{message.dialogflow.intent == 'food.end'}}",
    "params": {
        "content": "{{ dialogflow.fulfillment_text }}",
        "receiver": "$message.sender",
        "sender": "$message.receiver"
    }
}, {
    "id": "LCUPdM6q5tFV2rdu0Ufx",
    "type": "Message",
    "priority": 1,
    "condition": "{{message.dialogflow.action.startswith('smalltalk')}}",
    "params": {
        "sender": "$message.receiver",
        "content": "{{ dialogflow.fulfillment_text }}",
        "receiver": "$message.sender"
    }
}, {
    "id": "M3Fmlhjv4Az1d4vn5XDs",
    "type": "Message",
    "priority": 1,
    "condition": "{{message.dialogflow.intent == 'system.welcome' and sender.name != None}}",
    "params": {
        "receiver": "$message.sender",
        "sender": "$message.receiver",
        "content": "{{ dialogflow.fulfillment_text }}, {{ sender.name.first }}"
    }
}, {
    "id": "Qx5DH1cjtQIZUJJbwzyB",
    "type": "OAuth",
    "priority": 2,
    "condition": "{{message.dialogflow.action == 'connect.dexcom'}}",
    "params": {
        "person_id": "$sender.id",
        "provider": "dexcom"
    }
}, {
    "id": "BMUBxeYARWiYaAnRsHNFCg",
    "type": "Message",
    "priority": 1,
    "condition": "{{message.dialogflow.action == 'connect.dexcom'}}",
    "params": {
        "content": "Visit {{ oauth.url }}",
        "sender": "$message.receiver",
        "receiver": "$message.sender"
    }
}, {
    "id": "UjclBjOUF88VnnhBPnzF",
    "type": "SimplePatternCheck",
    "priority": 2,
    "hold_secs": 3600,
    "condition": "{{data.source.type == 'dexcom'}}",
    "params": {
        "person_id": "$data.source.id",
        "max_threshold": 30,
        "seconds": 14400,
        "name": "glucose"
    }
}, {
    "id": "5IcqdTjPalz1E310eKiF",
    "type": "Update",
    "priority": 1,
    "condition": "{{data.pattern == 'slope'}}",
    "params": {
        "content": "{'dialogflow': {'context': {'name': 'food_report', 'lifespan': 5}}}",
        "identifier": "$sender.id",
        "collection": "persons"
    }
}, {
    "id": "LPRTZpIjwEp0DHYhGFDC",
    "type": "Message",
    "priority": 1,
    "condition": "{{data.pattern == 'slope'}}",
    "params": {
        "content": "What did you eat?",
        "receiver": "$sender"
    }
}, {
    "id": "XtUYsSJEWCCuJlQYE8Wr",
    "type": "Message",
    "priority": 1,
    "condition": "{{message.dialogflow.intent == 'system.welcome' and not sender.name}}",
    "params": {
        "content": "{{ dialogflow.fulfillment_text }} I am Ezra, what is your name?",
        "receiver": "$message.sender",
        "sender": "$message.receiver"
    }
}, {
    "id": "eySLlRqdQH6dNaqsu34C_Q",
    "type": "Message",
    "priority": 1,
    "condition": "{{data.systolic < 50 or 200 < data.systolic or data.diastolic < 40 or 150 < data.diastolic}}",
    "params": {
        "content": "please take again",
        "receiver": "$sender"
    }
}, {
    "id": "aZ4Oc5gspNy85fntVzJh",
    "type": "Message",
    "priority": 1,
    "condition": "{{message.dialogflow.action == 'food.report'}}",
    "params": {
        "content": "{{ dialogflow.fulfillment_text }}",
        "sender": "$message.receiver",
        "receiver": "$message.sender"
    }
}, {
    "id": "ccZ6ZNITTMWCS9rwE9hIrA",
    "type": "Message",
    "priority": 1,
    "condition": "{{message.dialogflow.intent == 'medication.report'}}",
    "content_select": "sequence",
    "params": {
        "content": [
            {
                "id": "1",
                "message": "Got it"
            },{
                "id": "2",
                "message": "Thanks for the update."
            },{
                "id": "3",
                "message": "Bravo!"
            }],
        "receiver": "$message.sender",
        "sender": "$message.receiver"
    }
}, {
    "id": "ffWxDX4rv37InPAuro05",
    "type": "OAuth",
    "priority": 2,
    "condition": "{{message.dialogflow.action == 'connect.google'}}",
    "params": {
        "provider": "google",
        "person_id": "$sender.id"
    }
}, {
    "id": "3lRtdErhSYKSc2K0o5u6nw",
    "type": "Message",
    "priority": 1,
    "condition": "{{message.dialogflow.intent == 'connect.google'}}",
    "params": {
        "content": "Visit {{ oauth.url }}",
        "receiver": "$message.sender",
        "sender": "$message.receiver"
    }
}, {
    "id": "zmrG5CweQGygxi9NPmbJmQ",
    "type": "DataExtract",
    "priority": 1,
    "condition": "{{message.dialogflow.intent == 'biomarker.report.bp'}}",
    "params": {
        "params": "$message.dialogflow.params",
        "person_id": "$sender.id"
    }
}, {
    "id": "skNVAa3cTkaLw9BpFVg__Q",
    "type": "Update",
    "priority": 1,
    "condition": "{{message.dialogflow.intent.split('.', 1)[0] in ['activity', 'biomarker', 'food', 'medication']}}",
    "params": {
        "list_name": "topics",
        "content": "{{message.dialogflow.intent.split('.', 1)[:1]}}",
        "identifier": "$sender.id",
        "collection": "persons"
    }
}]}
